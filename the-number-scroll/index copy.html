<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>the number scroll</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="./index copy.css" />
  </head>
  <body>
    <div id="app">
      <div class="observer">
        <number-scroll-linear :init-number="initNumber" :dist-number="distNumber"></number-scroll-linear>
      </div>
    </div>
    <script type="text/x-template" id="number-scroll-linear">
      <div  class="number-scroll-box">
         <div v-for="(number,index) in initNumberR.toString()" :key="index">
          <div class="dot" v-if="isNaN(number)">{{number}}</div>
          <div class="number-scroll" v-else :style="cssVars(number,index)">01234567890</div>
         </div>
      </div>
    </script>
    <script>
      const NumberScrollLinear = {
        template: '#number-scroll-linear',
        props: {
          initNumber: {
            type: [Number, String],
            default: 0
          },
          distNumber: {
            type: [Number, String],
            default: 0
          }
        },
        computed: {
          // 补位后的初始值，用于前位补0
          initNumberR() {
            let temp = this.initNumber.toString();
            const diff = this.distNumber.toString().length - this.initNumber.toString().length;
            if (diff > 0) {
              for (let i = 0; i < diff; i++) {
                temp = '0' + temp;
              }
            }
            return temp;
          },
          translateY() {
            return Number(this.initNumber) * 100;
          }
          // cssVars() {
          //   return {
          //     '--Y': '-' + (this.translateY + this.offsetY) + '%',
          //     '--d1': ((10 * 100 - (this.translateY + this.offsetY)) / 100) * 10 ** this.index + 's',
          //     '--d2': 10 * 10 ** this.index + 's'
          //   };
          // }
        },
        methods: {
          cssVars(num, index) {
            const index_reverse = this.initNumberR.length - index;
            const duration = 11;
            // ((10 * 100 - (this.translateY + this.offsetY)) / 100) * 10 ** this.index + 's',
            // const firstAnimationDuration =
            //   ((100 - (((10 - Number(num)) / 11) * 100 + this.getOffsetY(num, index))) / 100) * duration ** index_reverse;

            const firstAnimationDuration = (100 - (Number(num) / 11) * 100 + this.getOffsetY(num, index)) * duration ** (index_reverse - 1);

            return {
              transform: `translateY(-${(Number(num) / 11) * 100 + this.getOffsetY(num, index)}%)`
              // animation: `animation1 ${firstAnimationDuration}s linear,animation2 ${
              //   duration ** index_reverse
              // }s linear ${firstAnimationDuration}s infinite`
            };
          },
          getOffsetY(num, index) {
            const index_reverse = this.initNumberR.length - index;
            if (index_reverse === 1) {
              return 0;
            } else {
              // 倒数第二位 偏移量算上最后一位偏移
              let lastIndex = index + 1;
              let lastNumber = this.initNumberR[lastIndex];
              return lastNumber + this.getOffsetY(lastNumber, lastIndex) * 0.1;
            }
          }
        }
      };
      new Vue({
        el: '#app',
        components: { 'number-scroll-linear': NumberScrollLinear },
        data() {
          return {
            initNumber: '5656',
            duration: 1 * 60 * 60,
            distNumber: '19843'
          };
        },
        methods: {}
      });
    </script>
  </body>
</html>
